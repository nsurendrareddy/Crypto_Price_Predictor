<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Crypto AI Predictor — Top Coins</title>
  <link rel="stylesheet" href="/static/css/style.css" />
  <link rel="stylesheet" href="/static/css/dark-theme.css" id="dark-theme-link" disabled />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <style>
    :root {
      --bg: #0f1222;
      --bg-soft: #171a2f;
      --card: #1b2040;
      --text: #e9ecff;
      --muted: #b5b9d9;
      --accent: #79d2ff;
      --accent-2: #c29dff;
      --ring: rgba(121, 210, 255, 0.35);
      --coin-shadow: rgba(0, 0, 0, 0.35);
      --overlay: rgba(15, 18, 34, 0.75);
    }

    [data-theme="light"] {
      --bg: #f7f8ff;
      --bg-soft: #eef1ff;
      --card: #ffffff;
      --text: #0f1222;
      --muted: #3a3d55;
      --accent: #246bfe;
      --accent-2: #7a3cff;
      --ring: rgba(36, 107, 254, 0.25);
      --coin-shadow: rgba(0, 0, 0, 0.18);
      --overlay: rgba(255, 255, 255, 0.8);
    }

    body {
      background: radial-gradient(1200px 600px at 10% -10%, var(--bg-soft), var(--bg));
      color: var(--text);
      min-height: 100vh;
    }

    .navbar {
      background: linear-gradient(90deg, var(--card), var(--bg-soft));
      box-shadow: 0 10px 30px -12px var(--ring);
    }

    .navbar-brand {
      font-weight: 800;
      letter-spacing: 0.3px;
    color: var(--text) !important;
    }

    /* Fix for navbar links */
    .navbar-nav .nav-link {
      color: var(--text) !important;
    }

    .navbar-nav .nav-link.active {
      color: var(--accent) !important;
      font-weight: 600;
    }

    .navbar-nav .nav-link:hover {
      color: var(--accent) !important;
    }

    /* Fix for navbar toggler in dark mode */
    .navbar-toggler {
      border-color: var(--muted);
    }

    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28233, 236, 255, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='m4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }

    [data-theme="light"] .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%2815, 18, 34, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='m4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }


    /* Custom Table Styles */
    .market-table-container {
      background: var(--card);
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 20px 40px -10px var(--ring);
      border: 1px solid rgba(121, 210, 255, 0.1);
      backdrop-filter: blur(10px);
    }

    .market-header {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      padding: 25px 30px;
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .market-title {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .market-subtitle {
      font-size: 0.9rem;
      opacity: 0.8;
      margin: 0;
    }

    .coins-grid {
      padding: 0;
    }

    .coin-row {
      display: flex;
      align-items: center;
      padding: 20px 30px;
      border-bottom: 1px solid rgba(121, 210, 255, 0.05);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;
      position: relative;
      background: var(--card);
    }

    .coin-row::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      transform: scaleY(0);
      transition: transform 0.3s ease;
    }

    .coin-row:hover {
      background: var(--bg-soft);
      transform: translateX(8px);
      box-shadow: 0 8px 25px -8px var(--ring);
    }

    .coin-row:hover::before {
      transform: scaleY(1);
    }

    .coin-row:last-child {
      border-bottom: none;
    }

    .coin-rank {
      width: 60px;
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--accent);
      text-align: center;
      position: relative;
    }

    .coin-rank::after {
      content: '';
      position: absolute;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 1px;
      height: 30px;
      background: rgba(121, 210, 255, 0.2);
    }

    .coin-info {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 15px;
      margin-left: 25px;
    }

    .coin-logo {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      box-shadow: 0 4px 12px var(--coin-shadow);
      transition: transform 0.3s ease;
    }

    .coin-row:hover .coin-logo {
      transform: scale(1.1) rotate(5deg);
    }

    .coin-details {
      flex: 1;
    }

    .coin-name {
      font-size: 1.1rem;
      font-weight: 600;
      margin: 0 0 5px 0;
      color: var(--text);
    }

    .coin-symbol {
      background: linear-gradient(135deg, var(--accent), var(--accent-2));
      color: white;
      padding: 3px 10px;
      border-radius: 15px;
      font-size: 0.75rem;
      font-weight: 600;
      letter-spacing: 0.5px;
    }

    .coin-metrics {
      display: flex;
      gap: 40px;
      align-items: center;
    }

    .metric-item {
      text-align: right;
      min-width: 120px;
    }

    .metric-label {
      font-size: 0.8rem;
      color: var(--muted);
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
    }

    .metric-value {
      font-size: 1rem;
      font-weight: 700;
      font-family: 'Monaco', 'Consolas', monospace;
    }

    .price-value {
      font-size: 1.2rem;
      color: var(--accent);
    }

    .change-positive {
      color: #10b981;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .change-negative {
      color: #ef4444;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .change-positive::before {
      content: '▲';
      font-size: 0.8rem;
    }

    .change-negative::before {
      content: '▼';
      font-size: 0.8rem;
    }

    .market-cap {
      color: var(--muted);
    }

    .click-indicator {
      opacity: 0;
      transition: opacity 0.3s ease;
      color: var(--accent);
      font-size: 0.9rem;
      margin-left: 15px;
    }

    .coin-row:hover .click-indicator {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .coin-row {
        flex-direction: column;
        align-items: stretch;
        padding: 20px;
        gap: 15px;
      }

      .coin-rank {
        width: auto;
        text-align: left;
      }

      .coin-rank::after {
        display: none;
      }

      .coin-info {
        margin-left: 0;
      }

      .coin-metrics {
        gap: 20px;
        justify-content: space-between;
      }

      .metric-item {
        min-width: auto;
        flex: 1;
        text-align: center;
      }

      .market-header {
        padding: 20px;
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
    }

    /* Loading Animation */
    .loading-shimmer {
      background: linear-gradient(
        90deg,
        var(--bg-soft) 25%,
        var(--card) 50%,
        var(--bg-soft) 75%
      );
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* Modal Styles from index.html */
    .modal-content {
      background: var(--card);
      color: var(--text);
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 20px 60px -20px var(--coin-shadow);
    }

    .modal-header {
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    }

    .modal-footer {
      border-top: 1px solid rgba(255, 255, 255, 0.08);
    }

    .btn-accent {
      background: linear-gradient(90deg, var(--accent), var(--accent-2));
      color: #fff;
      border: 0;
      box-shadow: 0 10px 30px -12px var(--ring);
    }

    .btn-accent:hover {
      filter: brightness(1.05);
    }

    .badge-signal {
      background: rgba(121, 210, 255, 0.15);
      color: var(--accent);
      border: 1px solid var(--ring);
    }

    .price-chip {
      background: rgba(0, 0, 0, 0.1);
      border: 1px dashed var(--ring);
      padding: 8px 12px;
      border-radius: 12px;
    }

    .toast-container {
      z-index: 2000;
    }

    .subtle {
      color: var(--muted);
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="/">
        <i class="bi bi-graph-up-arrow"></i><span>Crypto AI Predictor</span>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="nav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
          <li class="nav-item"><a class="nav-link active" href="/top-coins">Top Coins</a></li>
          <li class="nav-item"><a class="nav-link" href="/news">News</a></li>
          <li class="nav-item"><a class="nav-link" href="/portfolio">Portfolio</a></li>
          <li class="nav-item"><a class="nav-link" href="/about">About</a></li>
        </ul>
        <div class="d-flex align-items-center gap-3">
          <div class="form-check form-switch">
            <input class="form-check-input" type="checkbox" id="themeToggle">
            <label class="form-check-label" for="themeToggle"><i class="bi bi-moon-stars"></i></label>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <main class="container py-5">
    <h1 class="mb-4">Top Coins — Live Market</h1>
    
    <div class="market-table-container">
      <div class="market-header">
        <div>
          <h2 class="market-title">
            <i class="bi bi-graph-up"></i>
            Top 10 Cryptocurrencies
          </h2>
          <p class="market-subtitle">Live market data and real-time prices</p>
        </div>
        <div class="d-flex align-items-center gap-2">
          <i class="bi bi-arrow-clockwise"></i>
          <span style="font-size: 0.9rem;">Live Data</span>
        </div>
      </div>
      
      <div class="coins-grid" id="coinsGrid">
        <!-- Coin rows will be inserted here -->
      </div>
    </div>
  </main>

  <!-- Modal with Portfolio Feature (same as index.html) -->
  <div class="modal fade" id="coinModal" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title d-flex align-items-center gap-2" id="coinModalTitle">
            <img id="modalLogo" src="" alt="logo" width="28" height="28" style="object-fit:contain" />
            <span id="modalName">Coin</span>
            <span class="badge rounded-pill badge-signal" id="modalSymbol"></span>
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-4">
            <div class="col-12 col-lg-8">
              <canvas id="priceChart" height="160"></canvas>
              <div class="d-flex flex-wrap gap-3 mt-3">
                <div class="price-chip"><small class="subtle">Pred (3M):</small> <strong id="pred3m">—</strong></div>
                <div class="price-chip"><small class="subtle">Pred (6M):</small> <strong id="pred6m">—</strong></div>
                <div class="price-chip"><small class="subtle">Pred (1Y):</small> <strong id="pred1y">—</strong></div>
              </div>
            </div>
            <div class="col-12 col-lg-4">
              <div class="mb-3">
                <div class="subtle">Current Price</div>
                <div class="fs-4 fw-bold" id="modalCurrent">—</div>
              </div>
              <div class="mb-3">
                <label class="form-label">Add to Portfolio</label>
                <div class="btn-group w-100 mb-2" role="group">
                  <input type="radio" class="btn-check" name="addMode" id="modeQty" checked>
                  <label class="btn btn-outline-secondary" for="modeQty">By Quantity</label>
                  <input type="radio" class="btn-check" name="addMode" id="modeBudget">
                  <label class="btn btn-outline-secondary" for="modeBudget">By Budget</label>
                </div>
                <div id="qtyGroup" class="input-group mb-2">
                  <span class="input-group-text">Qty</span>
                  <input type="number" min="0" step="0.00000001" class="form-control" id="inputQty"
                    placeholder="e.g., 0.5">
                </div>
                <div id="budgetGroup" class="input-group mb-2" style="display:none;">
                  <span class="input-group-text">Budget (₹)</span>
                  <input type="number" min="0" step="0.01" class="form-control" id="inputBudget"
                    placeholder="e.g., 5000">
                </div>
                <button class="btn btn-accent w-100" id="btnAddPortfolio"><i class="bi bi-plus-lg me-1"></i>Add</button>
                <small class="d-block mt-2 subtle">Tip: You can manage your holdings on the Portfolio page.</small>
              </div>
              <hr />
              <div>
                <h6 class="fw-bold mb-2">About</h6>
                <p id="modalAbout" class="mb-0"></p>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast notification -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="appToast" class="toast align-items-center text-bg-dark border-0" role="alert" aria-live="assertive"
      aria-atomic="true">
      <div class="d-flex">
        <div class="toast-body" id="toastBody">Added to portfolio.</div>
        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
          aria-label="Close"></button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="/static/js/main.js"></script>
  <script>
   (async function(){
  const ids = window.COIN_LIST.map(c=>c.id).join(',');
  const res = await fetch(`/api/markets?ids=${ids}&vs_currency=inr`);
  const data = await res.json();
  const grid = document.getElementById('coinsGrid');
  
  grid.innerHTML = data.slice(0,10).map((c,i)=>{
    const ch = c.price_change_percentage_24h || 0;
    const changeClass = ch >= 0 ? 'change-positive' : 'change-negative';
    return `
      <div class="coin-row" data-index="${i}">
        <div class="coin-rank">${i+1}</div>
        <div class="coin-info">
          <img src="/static/images/${(c.symbol||'').toLowerCase()}.png" 
               class="coin-logo" 
               alt="${c.name}" 
               style="object-fit:contain"/>
          <div class="coin-details">
            <h3 class="coin-name">${c.name}</h3>
            <span class="coin-symbol">${(c.symbol||'').toUpperCase()}</span>
          </div>
        </div>
        <div class="coin-metrics">
          <div class="metric-item">
            <div class="metric-label">Price</div>
            <div class="metric-value price-value">₹${new Intl.NumberFormat('en-IN').format(c.current_price)}</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">24h Change</div>
            <div class="metric-value ${changeClass}">${ch.toFixed(2)}%</div>
          </div>
          <div class="metric-item">
            <div class="metric-label">Market Cap</div>
            <div class="metric-value market-cap">₹${new Intl.NumberFormat('en-IN').format(c.market_cap||0)}</div>
          </div>
        </div>
        <div class="click-indicator">
          <i class="bi bi-arrow-right-circle"></i> View Details
        </div>
      </div>
    `;
  }).join('');

  // Attach click handler using openCoinModal (not showCoinModal)
  document.querySelectorAll('.coin-row').forEach((row, i) => {
    row.addEventListener('click', () => {
      const coin = data[i];
      openCoinModal({
        symbol: coin.symbol.toUpperCase(),
        id: coin.id,
        name: coin.name
      });
    });
  });
})();

  </script>
</body>
</html>